<!DOCTYPE html>
<html>

<head>
  <title>7-11 store</title>
  <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="/javascripts/jquery-2.1.1.min.js" type="text/javascript"></script>
  <script src="/javascripts/bootstrap.min.js" type="text/javascript"></script>
</head>

<body>
  <h1>购物中心</h1>
  <div>
    <p id='title'>Welcome <%= user.name %></p>
    <p>it is a supermarket</p>
  </div>
  <div style="display: flex;">
    <div class='add-commodity'><button type="button" onclick="addcommodity();">添加商品</button></div>
    <div class='go-cart' style="margin-left: 20px;"><button type="button" onclick="goCart();">购物车</button></div>
    <div>当前购物车商品数: <%= cartNumber %></div>
  </div>
  <div class='commodity' style="display: flex; flex-Direction: row; flex-wrap: wrap;">
    <% commoditys.forEach(function(commodity, index){ %>
      <div style="flex-Direction: column;">
        <div>商品名称：<%= commodity.name %></div>
        <div>商品价格：<%= commodity.price %>元/千克</div>
        <% if (commodity.imgSrc) { %>
          <img src="<%= commodity.imgSrc %>"/>
        <% } else { %>
          <img src="/images/xmsz-2.jpg" alt="默认图片"/>
        <% } %>
      <button style="align-self: center;" type="button" data-id="<%=commoditys[index]._id%>" onclick='addcart(event);'>加入购物车</button>
      </div>
    <% })%>
  </div>
<script type="text/javascript">
  function addcart(e) {
    var id= e.target.getAttribute('data-id');
    $.ajax({
      url: '/addToCart/' + id,
      type: 'POST',
      data: {},
      success: function(data, status){
        if(status == 'success'){
          alert('加入购物车成功');
          location.href = 'home';
        }
      },
      error: function(data, status) {
        if (status == 'error') {
          alert('加入购物车失败');
        }
      },
    })
  }
  function addcommodity(){
    location.href = 'addcommodity';
  }
  function goCart(){
    location.href = 'cart';
  }
</script>
</body>
</html>