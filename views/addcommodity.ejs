<!DOCTYPE html>
<html>
  <head>
    <title>7-11 store</title>
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="/javascripts/jquery-2.1.1.min.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap.min.js" type="text/javascript"></script>
  </head>
  <body>
    <h1>商品添加中心</h1>
    <div>
      <p>Welcome </p>
      <p>it is a supermarket</p>
    </div>
    <div>商品名称: <input type="text" id='name' name='commodity' /></div>
    <div>商品价格: <input type="text" id='price' name='commodity' /></div>
    <div>商品数量: <input type="text" id='number' name='commodity'/></div>
    <div>商品图片: <input type="file" id='imgSrc' name='commodity' /></div>
    <button type="button" onclick="add();">添加</button>
    <button type="button" onclick="cancel();">取消</button>
<script type="text/javascript">
function add() {
  var commodity = {};
  var verify = true;
  var matchFunc = function(value, id){
    switch(id){
      case 'name':
        if(/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/.test(value)){return true};
        return false;
        break;
      case 'price':
        if(/^(0|\d+)$/.test(value)){return true};
        return false;
        break;
      case 'number':
        if(/^(0|\d+)$/.test(value)){return true};
        return false;
        break;
      default:
        return true
    }
    return true
  };
  $("input[name='commodity']").each(function(index, item){
    if(matchFunc(item.value, item.id)){
      commodity[item.id] = item.value;
    } else{
      verify = false;
    }
  })
  if( verify ){
    console.log(commodity);
    $.ajax({
      url: "/addcommodity",
      type: "POST",
      data: commodity,
      success: function(data, status) {
        if (status == "success") {
          alert('添加成功!');
          cancel();
        }
      },
      error: function(data, status) {
        if (status == "error") {
          location.href = "/error";
        }
      }
    });
  } else {
    alert('请输入正确的商品价格和商品数量');
  }
}
function cancel() {
  $("input[name='commodity']").each(function(index, item){
    item.value = '';
  })
  location.href = '/home';
}
</script>
</body>
</html>
